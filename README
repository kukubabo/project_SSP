##############
##project SSP
##############

## eksctl 0.37.0
eksctl create cluster -f cluster.yaml   # yaml 파일은 요건 보고 좀 더 고민

## calico 적용하려면
# 1. aws-node 삭제
kubectl delete daemonset -n kube-system aws-node
# 2. calico 설치
kubectl apply -f https://docs.projectcalico.org/manifests/calico-vxlan.yaml

## nodegroup 생성
# 1. keypare 생성 (노드 접속용)
콘솔에서 EC2 메뉴에서 keypare 에서 생성하고 pem 키 받아두기

# 2. nodegroup 생성
eksctl create nodegroup -f nodegroup.fe.yaml

## calico 설정
# 1. pod ip 확인
kubectl get pod -o wide -A --all-namespaces

# 2. Calico Pod CIDR 설정(수정)
kubectl edit ippool default-ipv4-ippool

# 3. POD 재기동
kubectl delete pod -n kube-system calico-kube-controllers-8586758878-45zvx coredns-6fb4cf484b-5s2s7 coredns-6fb4cf484b-nllzp

# 4. pod ip 변경 확인
kubectl get pod -o wide -A --all-namespaces

# 5. Ipamblock 확인
kubectl get ipamblocks

# 6. Ipamblock 삭제 - 기존의 IP block 을 삭제
kubectl delete ipamblocks 192-168-xxx-0-26 192-168-xxx-64-26


##### metrics-server
wget  https://github.com/kubernetes-sigs/metrics-server/releases/download/v0.4.1/components.yaml

# deployment.spec 에 hostNetwork: true 추가 하고 저장
kubectl apply -f components.yaml

kubectl top node


